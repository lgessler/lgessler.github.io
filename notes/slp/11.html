<!doctype html>
<html lang="en">
<head>
<title>Speech and Language Processing 3ed draft, Chapter 11, Syntactic Parsing</title>
<!-- 2018-08-25 Sat 02:03 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="generator" content="Org-mode">
<meta name="author" content="Luke Gessler">

<link  href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/js/bootstrap.min.js"></script>
<style type="text/css">
/* org mode styles on top of twbs */

html {
    position: relative;
    min-height: 100%;
}

body {
    font-size: 18px;
    margin-bottom: 105px;
}

footer {
    position: absolute;
    bottom: 0;
    width: 100%;
    height: 101px;
    background-color: #f5f5f5;
}

footer > div {
    padding: 10px;
}

footer p {
    margin: 0 0 5px;
    text-align: center;
    font-size: 16px;
}

#table-of-contents {
    margin-top: 20px;
    margin-bottom: 20px;
}

blockquote p {
    font-size: 18px;
}

pre {
    font-size: 16px;
}

.footpara {
    display: inline-block;
}

figcaption {
  font-size: 16px;
  color: #666;
  font-style: italic;
  padding-bottom: 15px;
}

/* from twbs docs */

.bs-docs-sidebar.affix {
    position: static;
}
@media (min-width: 768px) {
    .bs-docs-sidebar {
        padding-left: 20px;
    }
}

/* All levels of nav */
.bs-docs-sidebar .nav > li > a {
    display: block;
    padding: 4px 20px;
    font-size: 14px;
    font-weight: 500;
    color: #999;
}
.bs-docs-sidebar .nav > li > a:hover,
.bs-docs-sidebar .nav > li > a:focus {
    padding-left: 19px;
    color: #A1283B;
    text-decoration: none;
    background-color: transparent;
    border-left: 1px solid #A1283B;
}
.bs-docs-sidebar .nav > .active > a,
.bs-docs-sidebar .nav > .active:hover > a,
.bs-docs-sidebar .nav > .active:focus > a {
    padding-left: 18px;
    font-weight: bold;
    color: #A1283B;
    background-color: transparent;
    border-left: 2px solid #A1283B;
}

/* Nav: second level (shown on .active) */
.bs-docs-sidebar .nav .nav {
    display: none; /* Hide by default, but at >768px, show it */
    padding-bottom: 10px;
}
.bs-docs-sidebar .nav .nav > li > a {
    padding-top: 1px;
    padding-bottom: 1px;
    padding-left: 30px;
    font-size: 12px;
    font-weight: normal;
}
.bs-docs-sidebar .nav .nav > li > a:hover,
.bs-docs-sidebar .nav .nav > li > a:focus {
    padding-left: 29px;
}
.bs-docs-sidebar .nav .nav > .active > a,
.bs-docs-sidebar .nav .nav > .active:hover > a,
.bs-docs-sidebar .nav .nav > .active:focus > a {
    padding-left: 28px;
    font-weight: 500;
}

/* Nav: third level (shown on .active) */
.bs-docs-sidebar .nav .nav .nav {
    padding-bottom: 10px;
}
.bs-docs-sidebar .nav .nav .nav > li > a {
    padding-top: 1px;
    padding-bottom: 1px;
    padding-left: 40px;
    font-size: 12px;
    font-weight: normal;
}
.bs-docs-sidebar .nav .nav .nav > li > a:hover,
.bs-docs-sidebar .nav .nav .nav > li > a:focus {
    padding-left: 39px;
}
.bs-docs-sidebar .nav .nav .nav > .active > a,
.bs-docs-sidebar .nav .nav .nav > .active:hover > a,
.bs-docs-sidebar .nav .nav .nav > .active:focus > a {
    padding-left: 38px;
    font-weight: 500;
}

/* Show and affix the side nav when space allows it */
@media (min-width: 992px) {
    .bs-docs-sidebar .nav > .active > ul {
        display: block;
    }
    /* Widen the fixed sidebar */
    .bs-docs-sidebar.affix,
    .bs-docs-sidebar.affix-bottom {
        width: 213px;
    }
    .bs-docs-sidebar.affix {
        position: fixed; /* Undo the static from mobile first approach */
        top: 20px;
    }
    .bs-docs-sidebar.affix-bottom {
        position: absolute; /* Undo the static from mobile first approach */
    }
    .bs-docs-sidebar.affix .bs-docs-sidenav,.bs-docs-sidebar.affix-bottom .bs-docs-sidenav {
        margin-top: 0;
        margin-bottom: 0
    }
}
@media (min-width: 1200px) {
    /* Widen the fixed sidebar again */
    .bs-docs-sidebar.affix-bottom,
    .bs-docs-sidebar.affix {
        width: 263px;
    }
}
</style>
<script type="text/javascript">
$(function() {
    'use strict';

    $('.bs-docs-sidebar li').first().addClass('active');

    $(document.body).scrollspy({target: '.bs-docs-sidebar'});

    $('.bs-docs-sidebar').affix();
});
</script><link rel='stylesheet' type='text/css' href='/css/styles.css'>
            <link href="https://fonts.googleapis.com/css?family=Roboto"
                  rel="stylesheet">
</head>
<body>
<div id="preamble" class="">
<div class="container"><div class="row"><div class="col-md-9"><div style="font-size:11px;text-align:center;"><a style="color:gray;" href="/">Home</a> <a style="color:gray;" href="/posts/">Blog</a></div><div style="margin-top:0px;margin-bottom:-12px;color:#a0a0a0;">Luke Gessler</div></div></div></div>
</div>
<div id="content" class="container">
<div class="row"><div class="col-md-9"><h1 class="title">Speech and Language Processing 3ed draft, Chapter 11, Syntactic Parsing</h1>
<style>
body { 
    max-width: 800px; 
    margin: 0 auto 0 auto;
} 
img { width: 100%; }
</style>
<!-- for svg -->
<style> .figure object { height: 250px; } </style>


<div id="outline-container-sec-" class="outline-2">
<h2 id="sec-">Exercises</h2>
<div class="outline-text-2" id="text-">
<p>
Exercises 11.1 and 11.2:
</p>

<div class="org-src-container">

<pre class="src src-python"><span class="org-keyword">from</span> pprint <span class="org-keyword">import</span> pprint

<span class="org-keyword">class</span> <span class="org-type">CFG</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-builtin">object</span><span class="org-rainbow-delimiters-depth-1">)</span>:
    <span class="org-keyword">def</span> <span class="org-function-name">__init__</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">self</span><span class="org-rainbow-delimiters-depth-1">)</span>:
        <span class="org-keyword">self</span>._productions = <span class="org-rainbow-delimiters-depth-1">[]</span>

    <span class="org-keyword">def</span> <span class="org-function-name">productions</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">self</span><span class="org-rainbow-delimiters-depth-1">)</span>:
        <span class="org-keyword">return</span> <span class="org-keyword">self</span>._productions

    <span class="org-keyword">def</span> <span class="org-function-name">add_production</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">self</span>, lhs, rhs<span class="org-rainbow-delimiters-depth-1">)</span>:
        <span class="org-keyword">self</span>._productions.append<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>lhs, rhs<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

    <span class="org-keyword">def</span> <span class="org-function-name">find_productions</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">self</span>, target_lhs<span class="org-rainbow-delimiters-depth-1">)</span>:
        <span class="org-variable-name">tmp</span> = <span class="org-rainbow-delimiters-depth-1">[]</span>
        <span class="org-keyword">for</span> lhs, rhs <span class="org-keyword">in</span> <span class="org-keyword">self</span>._productions:
            <span class="org-keyword">if</span> lhs == target_lhs:
                tmp.append<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>lhs, rhs<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
        <span class="org-keyword">return</span> tmp

    <span class="org-keyword">def</span> <span class="org-function-name">only_produced_by_units</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">self</span>, target_lhs<span class="org-rainbow-delimiters-depth-1">)</span>:
        <span class="org-doc">"""Returns true if (a) there is at least one unit production that produces</span>
<span class="org-doc">        the argument, and (b) there are only unit productions that produce it. """</span>
        <span class="org-variable-name">appears</span> = <span class="org-constant">False</span>
        <span class="org-keyword">for</span> _, rhs <span class="org-keyword">in</span> <span class="org-keyword">self</span>._productions:
            <span class="org-keyword">if</span> target_lhs <span class="org-keyword">in</span> rhs:
                <span class="org-variable-name">appears</span> = <span class="org-constant">True</span>
                <span class="org-keyword">if</span> <span class="org-builtin">len</span><span class="org-rainbow-delimiters-depth-1">(</span>rhs<span class="org-rainbow-delimiters-depth-1">)</span> &gt; <span class="org-highlight-numbers-number">1</span>:
                    <span class="org-keyword">return</span> <span class="org-constant">False</span>
        <span class="org-keyword">return</span> appears

    <span class="org-keyword">def</span> <span class="org-function-name">sort</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">self</span><span class="org-rainbow-delimiters-depth-1">)</span>:
        <span class="org-keyword">self</span>._productions.sort<span class="org-rainbow-delimiters-depth-1">(</span>key=<span class="org-keyword">lambda</span> x:x<span class="org-rainbow-delimiters-depth-2">[</span><span class="org-highlight-numbers-number">0</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>

    <span class="org-comment-delimiter"># </span><span class="org-comment">just checking for lhs, not the entire rule</span>
    <span class="org-keyword">def</span> <span class="org-function-name">__contains__</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">self</span>, target_lhs<span class="org-rainbow-delimiters-depth-1">)</span>:
        <span class="org-keyword">for</span> lhs, _ <span class="org-keyword">in</span> <span class="org-keyword">self</span>._productions:
            <span class="org-keyword">if</span> target_lhs == lhs:
                <span class="org-keyword">return</span> <span class="org-constant">True</span>
        <span class="org-keyword">return</span> <span class="org-constant">False</span>

    <span class="org-comment-delimiter"># </span><span class="org-comment">all methods below here are used for CKY parsing. Some of them will have</span>
    <span class="org-comment-delimiter"># </span><span class="org-comment">worse time performance than they need to (like many of the methods above),</span>
    <span class="org-comment-delimiter"># </span><span class="org-comment">and could be solved with indexes or other means in a practical system.</span>
    <span class="org-keyword">def</span> <span class="org-function-name">find_unit_word_productions</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">self</span>, word<span class="org-rainbow-delimiters-depth-1">)</span>:
        <span class="org-doc">"""Given a word, return a list of all left hand sides for rules that</span>
<span class="org-doc">        produce ONLY the word on the right hand side."""</span>
        <span class="org-keyword">return</span> <span class="org-rainbow-delimiters-depth-1">[</span>lhs <span class="org-keyword">for</span> lhs, rhs <span class="org-keyword">in</span> <span class="org-keyword">self</span>._productions \
                <span class="org-keyword">if</span> rhs == <span class="org-rainbow-delimiters-depth-2">[</span>word<span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">]</span>

    <span class="org-keyword">def</span> <span class="org-function-name">find_compatible_binary_productions</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">self</span>, rhs1, rhs2<span class="org-rainbow-delimiters-depth-1">)</span>:
        <span class="org-keyword">return</span> <span class="org-rainbow-delimiters-depth-1">[</span>lhs <span class="org-keyword">for</span> lhs, rhs <span class="org-keyword">in</span> <span class="org-keyword">self</span>._productions \
                <span class="org-keyword">if</span> <span class="org-builtin">len</span><span class="org-rainbow-delimiters-depth-2">(</span>rhs<span class="org-rainbow-delimiters-depth-2">)</span> == <span class="org-highlight-numbers-number">2</span> <span class="org-keyword">and</span> rhs<span class="org-rainbow-delimiters-depth-2">[</span><span class="org-highlight-numbers-number">0</span><span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-keyword">in</span> rhs1 <span class="org-keyword">and</span> rhs<span class="org-rainbow-delimiters-depth-2">[</span><span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-keyword">in</span> rhs2<span class="org-rainbow-delimiters-depth-1">]</span>


<span class="org-keyword">def</span> <span class="org-function-name">cnf_gen_symbol</span><span class="org-rainbow-delimiters-depth-1">(</span>g<span class="org-rainbow-delimiters-depth-1">)</span>:
    <span class="org-variable-name">pre</span> = <span class="org-string">"X"</span>
    <span class="org-variable-name">n</span> = <span class="org-highlight-numbers-number">1</span>
    <span class="org-keyword">while</span> <span class="org-rainbow-delimiters-depth-1">(</span>pre + <span class="org-builtin">str</span><span class="org-rainbow-delimiters-depth-2">(</span>n<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">in</span> g:
        <span class="org-variable-name">n</span> += <span class="org-highlight-numbers-number">1</span>
    <span class="org-keyword">return</span> pre + <span class="org-builtin">str</span><span class="org-rainbow-delimiters-depth-1">(</span>n<span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-keyword">def</span> <span class="org-function-name">cnf_flatten</span><span class="org-rainbow-delimiters-depth-1">(</span>g, new_g<span class="org-rainbow-delimiters-depth-1">)</span>:
    <span class="org-keyword">for</span> lhs, rhs <span class="org-keyword">in</span> g.productions<span class="org-rainbow-delimiters-depth-1">()</span>:
        <span class="org-comment-delimiter"># </span><span class="org-comment">check to make sure it's a unit production</span>
        <span class="org-keyword">if</span> <span class="org-builtin">len</span><span class="org-rainbow-delimiters-depth-1">(</span>rhs<span class="org-rainbow-delimiters-depth-1">)</span> != <span class="org-highlight-numbers-number">1</span>:
            <span class="org-keyword">continue</span>
        <span class="org-comment-delimiter"># </span><span class="org-comment">We need to flatten top-level symbols and symbols that are produced in non-unit</span>
        <span class="org-comment-delimiter"># </span><span class="org-comment">productions, but we want to skip symbols that are ONLY produced by unit productions</span>
        <span class="org-comment-delimiter"># </span><span class="org-comment">since they will be handled by recursing on the former</span>
        <span class="org-keyword">if</span> g.only_produced_by_units<span class="org-rainbow-delimiters-depth-1">(</span>lhs<span class="org-rainbow-delimiters-depth-1">)</span>:
            <span class="org-keyword">continue</span>
        cnf_flatten_dfs<span class="org-rainbow-delimiters-depth-1">(</span>g, new_g, lhs, rhs<span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-keyword">def</span> <span class="org-function-name">cnf_flatten_dfs</span><span class="org-rainbow-delimiters-depth-1">(</span>g, new_g, orig_lhs, rhs<span class="org-rainbow-delimiters-depth-1">)</span>:
    <span class="org-doc">"""for simplicity, we assume there are no cycles"""</span>
    <span class="org-keyword">if</span> <span class="org-builtin">len</span><span class="org-rainbow-delimiters-depth-1">(</span>rhs<span class="org-rainbow-delimiters-depth-1">)</span> == <span class="org-highlight-numbers-number">2</span>:
        new_g.add_production<span class="org-rainbow-delimiters-depth-1">(</span>orig_lhs, rhs<span class="org-rainbow-delimiters-depth-1">)</span>
    <span class="org-keyword">if</span> <span class="org-builtin">len</span><span class="org-rainbow-delimiters-depth-1">(</span>rhs<span class="org-rainbow-delimiters-depth-1">)</span> == <span class="org-highlight-numbers-number">1</span>:
        <span class="org-variable-name">rhs_val</span> = rhs<span class="org-rainbow-delimiters-depth-1">[</span><span class="org-highlight-numbers-number">0</span><span class="org-rainbow-delimiters-depth-1">]</span>

        <span class="org-comment-delimiter"># </span><span class="org-comment">need to keep going if there are more productions from this unit prod</span>
        <span class="org-keyword">if</span> rhs_val <span class="org-keyword">in</span> g:
            <span class="org-keyword">for</span> _, new_rhs <span class="org-keyword">in</span> g.find_productions<span class="org-rainbow-delimiters-depth-1">(</span>rhs_val<span class="org-rainbow-delimiters-depth-1">)</span>:
                cnf_flatten_dfs<span class="org-rainbow-delimiters-depth-1">(</span>g, new_g, orig_lhs, new_rhs<span class="org-rainbow-delimiters-depth-1">)</span>
        <span class="org-comment-delimiter"># </span><span class="org-comment">otherwise, we've found the leaf and we're done</span>
        <span class="org-keyword">else</span>:
            new_g.add_production<span class="org-rainbow-delimiters-depth-1">(</span>orig_lhs, rhs<span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-keyword">def</span> <span class="org-function-name">cnf_copy</span><span class="org-rainbow-delimiters-depth-1">(</span>g, new_g<span class="org-rainbow-delimiters-depth-1">)</span>:
    <span class="org-doc">"""Copy rules that don't need modification"""</span>
    <span class="org-keyword">for</span> lhs, rhs <span class="org-keyword">in</span> g.productions<span class="org-rainbow-delimiters-depth-1">()</span>:
        <span class="org-keyword">if</span> <span class="org-builtin">len</span><span class="org-rainbow-delimiters-depth-1">(</span>rhs<span class="org-rainbow-delimiters-depth-1">)</span> == <span class="org-highlight-numbers-number">2</span>:
            new_g.add_production<span class="org-rainbow-delimiters-depth-1">(</span>lhs, rhs<span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-keyword">def</span> <span class="org-function-name">cnf_binarize</span><span class="org-rainbow-delimiters-depth-1">(</span>g, new_g<span class="org-rainbow-delimiters-depth-1">)</span>:
    <span class="org-doc">"""Introduce dummy nodes and rewrite rules so they are binary if they</span>
<span class="org-doc">    produce non-terminals"""</span>
    <span class="org-keyword">for</span> lhs, rhs <span class="org-keyword">in</span> g.productions<span class="org-rainbow-delimiters-depth-1">()</span>:
        <span class="org-keyword">if</span> <span class="org-builtin">len</span><span class="org-rainbow-delimiters-depth-1">(</span>rhs<span class="org-rainbow-delimiters-depth-1">)</span> &lt;= <span class="org-highlight-numbers-number">2</span>:
            <span class="org-keyword">continue</span>
        <span class="org-keyword">while</span> <span class="org-builtin">len</span><span class="org-rainbow-delimiters-depth-1">(</span>rhs<span class="org-rainbow-delimiters-depth-1">)</span> &gt; <span class="org-highlight-numbers-number">2</span>:
            <span class="org-variable-name">new_prod</span> = cnf_gen_symbol<span class="org-rainbow-delimiters-depth-1">(</span>new_g<span class="org-rainbow-delimiters-depth-1">)</span>
            new_g.add_production<span class="org-rainbow-delimiters-depth-1">(</span>new_prod, rhs<span class="org-rainbow-delimiters-depth-2">[</span><span class="org-highlight-numbers-number">0</span>:<span class="org-highlight-numbers-number">2</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-variable-name">rhs</span> = <span class="org-rainbow-delimiters-depth-1">[</span>new_prod<span class="org-rainbow-delimiters-depth-1">]</span> + rhs<span class="org-rainbow-delimiters-depth-1">[</span><span class="org-highlight-numbers-number">2</span>:<span class="org-rainbow-delimiters-depth-1">]</span>
        new_g.add_production<span class="org-rainbow-delimiters-depth-1">(</span>lhs, rhs<span class="org-rainbow-delimiters-depth-1">)</span>


<span class="org-keyword">def</span> <span class="org-function-name">cnf</span><span class="org-rainbow-delimiters-depth-1">(</span>g<span class="org-rainbow-delimiters-depth-1">)</span>:
    <span class="org-variable-name">new_g</span> = CFG<span class="org-rainbow-delimiters-depth-1">()</span>
    cnf_copy<span class="org-rainbow-delimiters-depth-1">(</span>g, new_g<span class="org-rainbow-delimiters-depth-1">)</span>
    cnf_binarize<span class="org-rainbow-delimiters-depth-1">(</span>g, new_g<span class="org-rainbow-delimiters-depth-1">)</span>
    cnf_flatten<span class="org-rainbow-delimiters-depth-1">(</span>g, new_g<span class="org-rainbow-delimiters-depth-1">)</span>
    new_g.sort<span class="org-rainbow-delimiters-depth-1">()</span> <span class="org-comment-delimiter"># </span><span class="org-comment">for easier inspection of output</span>
    <span class="org-keyword">return</span> new_g

<span class="org-keyword">def</span> <span class="org-function-name">cky</span><span class="org-rainbow-delimiters-depth-1">(</span>g, words<span class="org-rainbow-delimiters-depth-1">)</span>:
    <span class="org-doc">"""G is assumed to be in CNF."""</span>
    <span class="org-variable-name">n</span> = <span class="org-builtin">len</span><span class="org-rainbow-delimiters-depth-1">(</span>words<span class="org-rainbow-delimiters-depth-1">)</span> + <span class="org-highlight-numbers-number">1</span>
    <span class="org-comment-delimiter"># </span><span class="org-comment">initialize 2d matrix with an empty list in each cell</span>
    <span class="org-variable-name">m</span> = <span class="org-rainbow-delimiters-depth-1">[</span><span class="org-rainbow-delimiters-depth-2">[</span><span class="org-builtin">set</span><span class="org-rainbow-delimiters-depth-3">()</span> <span class="org-keyword">for</span> j <span class="org-keyword">in</span> <span class="org-builtin">range</span><span class="org-rainbow-delimiters-depth-3">(</span>n<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-keyword">for</span> i <span class="org-keyword">in</span> <span class="org-builtin">range</span><span class="org-rainbow-delimiters-depth-2">(</span>n<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">]</span>

    <span class="org-keyword">for</span> j <span class="org-keyword">in</span> <span class="org-builtin">range</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-numbers-number">1</span>, n<span class="org-rainbow-delimiters-depth-1">)</span>:
        m<span class="org-rainbow-delimiters-depth-1">[</span>j-<span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-1">][</span>j<span class="org-rainbow-delimiters-depth-1">]</span> = m<span class="org-rainbow-delimiters-depth-1">[</span>j-<span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-1">][</span>j<span class="org-rainbow-delimiters-depth-1">]</span>.union<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-builtin">set</span><span class="org-rainbow-delimiters-depth-2">(</span>g.find_unit_word_productions<span class="org-rainbow-delimiters-depth-3">(</span>words<span class="org-rainbow-delimiters-depth-4">[</span>j-<span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-4">]</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

        <span class="org-keyword">for</span> i <span class="org-keyword">in</span> <span class="org-builtin">range</span><span class="org-rainbow-delimiters-depth-1">(</span>j-<span class="org-highlight-numbers-number">2</span>, -<span class="org-highlight-numbers-number">1</span>, -<span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-1">)</span>:
            <span class="org-keyword">for</span> k <span class="org-keyword">in</span> <span class="org-builtin">range</span><span class="org-rainbow-delimiters-depth-1">(</span>i+<span class="org-highlight-numbers-number">1</span>, j<span class="org-rainbow-delimiters-depth-1">)</span>:
                m<span class="org-rainbow-delimiters-depth-1">[</span>i<span class="org-rainbow-delimiters-depth-1">][</span>j<span class="org-rainbow-delimiters-depth-1">]</span> = m<span class="org-rainbow-delimiters-depth-1">[</span>i<span class="org-rainbow-delimiters-depth-1">][</span>j<span class="org-rainbow-delimiters-depth-1">]</span>.union<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-builtin">set</span><span class="org-rainbow-delimiters-depth-2">(</span>g.find_compatible_binary_productions<span class="org-rainbow-delimiters-depth-3">(</span>m<span class="org-rainbow-delimiters-depth-4">[</span>i<span class="org-rainbow-delimiters-depth-4">][</span>k<span class="org-rainbow-delimiters-depth-4">]</span>, m<span class="org-rainbow-delimiters-depth-4">[</span>k<span class="org-rainbow-delimiters-depth-4">][</span>j<span class="org-rainbow-delimiters-depth-4">]</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

    <span class="org-keyword">for</span> x <span class="org-keyword">in</span> m:
        <span class="org-keyword">print</span><span class="org-rainbow-delimiters-depth-1">(</span>x<span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-variable-name">g</span> = <span class="org-constant">None</span>
<span class="org-keyword">def</span> <span class="org-function-name">main</span><span class="org-rainbow-delimiters-depth-1">()</span>:
    <span class="org-keyword">global</span> g
    <span class="org-variable-name">g</span> = CFG<span class="org-rainbow-delimiters-depth-1">()</span>
    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"S"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"NP"</span>, <span class="org-string">"VP"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"S"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"Aux"</span>, <span class="org-string">"NP"</span>, <span class="org-string">"VP"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"S"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"VP"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>

    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"NP"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"Pronoun"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"NP"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"Proper-Noun"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"NP"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"Det"</span>, <span class="org-string">"Nominal"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>

    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Nominal"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"Noun"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Nominal"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"Nominal"</span>, <span class="org-string">"Noun"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Nominal"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"Nominal"</span>, <span class="org-string">"PP"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>

    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"VP"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"Verb"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"VP"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"Verb"</span>, <span class="org-string">"NP"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"VP"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"Verb"</span>, <span class="org-string">"NP"</span>, <span class="org-string">"PP"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"VP"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"Verb"</span>, <span class="org-string">"PP"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"VP"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"VP"</span>, <span class="org-string">"PP"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"PP"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"Preposition"</span>, <span class="org-string">"NP"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>

    <span class="org-comment-delimiter"># </span><span class="org-comment">terminals</span>
    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Det"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"that"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Det"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"this"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Det"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"the"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Det"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"a"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Noun"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"book"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Noun"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"flight"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Noun"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"meal"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Noun"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"money"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Verb"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"book"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Verb"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"include"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Verb"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"prefer"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Pronoun"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"I"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Pronoun"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"she"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Pronoun"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"me"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Proper-Noun"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"Houston"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Proper-Noun"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"NWA"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Aux"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"does"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Preposition"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"from"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Preposition"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"to"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Preposition"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"on"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Preposition"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"near"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
    g.add_production<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Preposition"</span>, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"through"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>

    <span class="org-comment-delimiter">#</span><span class="org-comment">g.add_production("a", ["c"])</span>
    <span class="org-comment-delimiter">#</span><span class="org-comment">g.add_production("b", ["c"])</span>
    <span class="org-comment-delimiter">#</span><span class="org-comment">g.add_production("c", ["d"])</span>
    <span class="org-comment-delimiter">#</span><span class="org-comment">g.add_production("d", ["e"])</span>
    <span class="org-comment-delimiter">#</span><span class="org-comment">g.add_production("e", ["f"])</span>
    <span class="org-comment-delimiter">#</span><span class="org-comment">g.add_production("e", ["g"])</span>

    <span class="org-variable-name">g</span> = cnf<span class="org-rainbow-delimiters-depth-1">(</span>g<span class="org-rainbow-delimiters-depth-1">)</span>
    <span class="org-comment-delimiter">#</span><span class="org-comment">pprint(g.productions())</span>
    cky<span class="org-rainbow-delimiters-depth-1">(</span>g, <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-string">"book"</span>, <span class="org-string">"the"</span>, <span class="org-string">"flight"</span>, <span class="org-string">"through"</span>, <span class="org-string">"Houston"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>


main<span class="org-rainbow-delimiters-depth-1">()</span>
</pre>
</div>
</div>
</div>
</div><div class="col-md-3"><nav id="table-of-contents">
<div id="text-table-of-contents" class="bs-docs-sidebar">
<ul class="nav">
<li><a href="#sec-">Exercises</a></li>
</ul>
</div>
</nav>
</div></div></div>
<footer id="postamble" class="">
<div class="container"><div class="row"><div class="col-md-9"><div id="disqus_thread"></div></div></div></div>
</footer>
</body>
</html>
